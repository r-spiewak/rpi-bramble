{% comment %}
This file copied and modified from 
https://github.com/zendesk/jekyll-theme-zendesk-garden/blob/main/_includes/sidebar.html
{% endcomment %}

<div class="sidenav">
  {% for item in site.sidebar %}
    {% if item.children %}
      <!-- {% capture id %}sidebar_item:{{ item.label | strip | downcase | remove: "'" | remove: '"' | escape }}{% endcapture %} -->
      {% capture id %}sidebar_item_{{ item.label | strip | downcase | remove: "'" | remove: '"' | replace: " ", "_" }}{% endcapture %}
      <!-- {% capture accordian_id %}{{ id }}:accordian{% endcapture %} -->
      {% capture accordion_id %}{{ id }}_accordion{% endcapture %}
      {% capture collapsibleClass %}
      {%- if item.children contains page.id -%}expanded{%- else -%}collapsed{%- endif -%}
      {% endcapture %}
      <!-- <button
        id="{{ id }}"
        class="sidebar_item sidebar_item_collapsible sidebar_item_{{ collapsibleClass }}"
        onclick="toggleAccordian('{{ id }}')"
      > -->
      <button
        id="{{ id }}"
        class="sidebar_item sidebar_item_collapsible sidebar_item_{{ collapsibleClass }}"
        onclick="toggleAccordion('{{ id }}')"
      >
        <span class="sidebar_item_text">{{ item.label }}</span>
        {% include collapsible_sidebar_icon.html %}
      </button>
      <!-- <div id="{{ accordian_id }}" 
        class="sidebar_item_accordian sidebar_item_accordian_{{ collapsibleClass }}">-->
      <!-- DEBUG site.site_content IDs: {{ site.site_content | map: "id" | join: ", " }}
      DEBUG item.children: {{ item.children | join: ", " }} -->
      <div id="{{ accordion_id }}"
        class="sidebar_item_accordion sidebar_item_accordion_{{ collapsibleClass }}">
        <!-- <p style="color:red;">Inside include: item.children = {{ item.children | jsonify }}</p> -->
        {% for child in item.children %}
          <!-- <p style="color:blue;">Inside child {{ child }}</p> -->
          <!-- {% assign meta = site.pages | where: "id", child | first %} -->
          <!-- {% assign meta = site.site_content | where: "id", child | first %} -->
          {% assign meta = nil %}
          {% for doc in site.site_content %}
            {% if doc.data.id == child %}
              {% assign meta = doc %}
              {% break %}
            {% endif %}
          {% endfor %}
          <p style="color:blueviolet">Meta: {{ meta }}</p>
          {% if meta %}
            {% if page.id == meta.id %}
              {% assign active_class = "active_sidebar_item" %}
            {% else %}
              {% assign active_class = "" %}
            {% endif %}
            <p>meta.url = {{ meta.url }}</p>
            <p style="color:green;">
              child={{ child }} meta.id={{ meta.id }} meta.url={{ meta.url }} meta.title={{ meta.title }}
            </p>
            <a href="{{ meta.url | relative_url }}" class="sidebar_item text-sm {{ active_class }} sidebar_item_child">
              {{ meta.sidebar_label | default: meta.title }}
            </a>
          {% endif %}
        {% endfor %}
      </div>
    {% else %}
      <!-- {% assign meta = site.pages | where: "id", item | first %} -->
      {% assign meta = site.site_content | where: "id", item | first %}
      {% if meta %}
      {% if page.id == meta.id %}
        {% assign active_class = "active_sidebar_item" %}
      {% else %}
        {% assign active_class = "" %}
      {% endif %}
      <a href="{{ meta.url | relative_url }}" class="sidebar_item {{ active_class }}">
        <span class="sidebar_item_text">{{ meta.sidebar_label | default: meta.title }}</span>
      </a>
      {% endif %}
    {% endif %}
  {% endfor %}
</div>